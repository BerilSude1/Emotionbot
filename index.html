<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Emotionbot</title>
    
</head>
    <style>
        body {
            font-family: Arial, Helvetica, sans-serif;
            background-color: #eee;
            background-size: 100% 160%;
            background-position: center;
            background-repeat: no-repeat;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            transition: background-color 0.5s, background-image 0.5s;
        }
        

        .chat-container {
            background-color: hsla(310, 56%, 40%, 0.484);
            padding: 10px;
            border-radius: 30px;
            box-shadow: 0 0 80px hsl(311, 75%, 58%);
            width: 350px;
            margin-top: 20px;
            margin-bottom: 30px;
            
            
        }

        .messages {
            max-height: 100px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        .message {
            padding: 20px;
            margin: 5px 0;
            border-radius: 5px;
        }

        .message.user {
            background-color: #d1e7dd;
            text-align: right;
        }

        .message.bot {
            background-color: #f8d7da;
            text-align: left;
        }

        textarea {
            width: 100%;
            padding: 20px;
            border-radius: 100px;
            border: 3px solid #be26c652;
            font-size: 23px;
            resize: none;
            box-sizing: border-box;
        }

        .playlist-container {
            margin-top: 15px;
            width: 100%;
        }
        .img-cntrl{
            display:flex;
            gap:10px;  
        }
        .image-controls {
            background:#ffffff2b;
            border: 2px solid #2c3e50;
            font-size: 14px;
            font-weight: bold;
            font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            text-transform: uppercase;
            padding: 12px 25px;
            min-width: 50px;
            margin:10px;
            cursor: pointer;
            position: relative;
            transition:color 0.4s linear;
            
            
        }
        .image-controls:hover{
            color: #FFF;
        }
        .image-controls::before{
            content:"";
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: #2c3e50;
            z-index: -1;
            transition: transform 0.5s;
            transform-origin: 0 0;
            transition-timing-function: cubic-bezier(0.5,1.6,0.4,0.7);

        }
        .image-controls::before{
            transform: scaleX(0);
        }

        .image-controls:hover::before{
            transform:scaleX(1);
        }

        .image-controls2 {
            background:#ffffff2b;
            border: 2px solid #2c3e50;
            font-size: 14px;
            font-weight: bold;
            font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            text-transform: uppercase;
            padding: 12px 20px;
            min-width: 50px;
            margin:10px;
            cursor: pointer;
            position: relative;
            transition:color 0.4s linear;
            
        }
        .image-controls2:hover{
            color: #FFF;
        }
        .image-controls2::before{
            content:"";
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: #2c3e50;
            z-index: -1;
            transition: transform 0.5s;
            transform-origin: 0 0;
            transition-timing-function: cubic-bezier(0.5,1.6,0.4,0.7);

        }
        .image-controls2::before{
            transform: scaleX(0);
        }

        .image-controls2:hover::before{
            transform:scaleX(1);
        }
        
        .decode-text {
            width: 100%;
            font-size: 30px;
            text-align: center;
            margin-bottom: 80px;
        }

        .space {
            display: inline-block;
            width: 10px;
        }

        .text-animation {
            display: inline-block;
            position: relative;
            color: transparent;
            text-transform: uppercase;
        }

        .text-animation:before {
            content: "";
            color: rgb(0, 0, 0);
            position: absolute;
            top: 50%;
            left: 50%;
            background: #0e182d;
            width: 0;
            height: 1.2em;
            transform: translate(-50%, -55%);
        }

        .text-animation.state-1:before {
            width: 5px;
        }

        .text-animation.state-2:before {
            width: 0.9em;
        }

        .text-animation.state-3 {
            color: rgb(67, 3, 59);
            font-size: 35px;
            font-weight:900;   
        }

        .text-animation.state-3:before {
            width: 0;

        }

        div {
            font-family:Georgia, 'Times New Roman', Times, serif;
        }

        .text {
            display: inline-block;
            position: relative;
        }

        .text span {
            display: inline-block;
            animation-name: color-text-flow-keys;
            animation-duration: 50s;
            animation-iteration-count: infinite;
            animation-direction: alternate;
            animation-fill-mode: forwards;
        }

        a {
            position: absolute;
            bottom: 10px;
            right: 10px;
            color: #eee;
            font-size: 15px;
            line-height: 10px;
        }

        .container { /*açıklama metninin konumları*/
            font-family:Arial, Helvetica, sans-serif;
            text-align: center;
            margin-bottom: 5px;
            font-size: large;
            font-weight: 400;
            text-shadow:100px 100px 100px white;
            
        }

        @keyframes color-text-flow-keys {
            0% {
                color: #692646;
            }

            5% {
                color: #328539;
            }

            10% {
                color: #40175c;
            }

            15% {
                color: #5274d0;
            }

            20% {
                color: #df4068;
            }

            25% {
                color: #88e361;
            }

            30% {
                color: #4b357b;
            }

            35% {
                color: #6f63e2;
            }

            40% {
                color: #69abe5;
            }

            45% {
                color: #459f54;
            }

            50% {
                color: #ad3933;
            }

            55% {
                color: #c27957;
            }

            60% {
                color: #951f1b;
            }

            65% {
                color: #b530d6;
            }

            70% {
                color: #538de3;
            }

            75% {
                color: #71a346;
            }

            80% {
                color: #91622e;
            }

            85% {
                color: #773347;
            }

            90% {
                color: #24972d;
            }

            95% {
                color: #9a4929;
            }

            100% {
                color: #347a2f;
            }
        }
    </style>
</head>

<body>

    <div class="decode-text">
        <div class="text-animation">E</div>
        <div class="text-animation">M</div>
        <div class="text-animation">O</div>
        <div class="text-animation">T</div>
        <div class="text-animation">I</div>
        <div class="text-animation">O</div>
        <div class="text-animation">N</div>
        <div class="text-animation">B</div>
        <div class="text-animation">O</div>
        <div class="text-animation">T</div>
        <div class="space"></div>
    </div>
    <div>
    <script>
        function decodeText() {
            var text = document.getElementsByClassName('decode-text')[0];
            var state = [];
            for (var i = 0, j = text.children.length; i < j; i++) {
                text.children[i].classList.remove('state-1', 'state-2', 'state-3');
                state[i] = i;
            }
            var shuffled = shuffle(state);
            for (var i = 0, j = shuffled.length; i < j; i++) {
                var child = text.children[shuffled[i]];
                classes = child.classList;
                var state1Time = Math.round(Math.random() * (2000 - 300)) + 50;
                if (classes.contains('text-animation')) {
                    setTimeout(firstStages.bind(null, child), state1Time);
                }
            }
        }

        function firstStages(child) {
            if (child.classList.contains('state-2')) {
                child.classList.add('state-3');
            } else if (child.classList.contains('state-1')) {
                child.classList.add('state-2')
            } else if (!child.classList.contains('state-1')) {
                child.classList.add('state-1');
                setTimeout(secondStages.bind(null, child), 100);
            }
        }

        function secondStages(child) {
            if (child.classList.contains('state-1')) {
                child.classList.add('state-2')
                setTimeout(thirdStages.bind(null, child), 100);
            } else if (!child.classList.contains('state-1')) {
                child.classList.add('state-1')
            }
        }

        function thirdStages(child) {
            if (child.classList.contains('state-2')) {
                child.classList.add('state-3')
            }
        }

        function shuffle(array) {
            var currentIndex = array.length,
                temporaryValue, randomIndex;
            while (0 !== currentIndex) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex -= 1;
                temporaryValue = array[currentIndex];
                array[currentIndex] = array[randomIndex];
                array[randomIndex] = temporaryValue;
            }
            return array;
        }

        decodeText();
        setInterval(function () { decodeText(); }, 6000);
    </script>
    </div>

    <style>
    .color-text-flow {
        font-family:'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
        font-weight:bold;
        font-size:15px;
          text-shadow: -2px -2px 2px rgba(255, 255, 255, 0.568); /* Beyaz gölge */
    }
    </style>
    <div class="container">
        <div class="text">
            <span class="color-text-flow">Merhaba!</span>
            <span class="color-text-flow">Emotionbot</span>
            <span class="color-text-flow">ile</span>
            <span class="color-text-flow">tanışın.</span>
        <br><span class="color-text-flow">Emotionbot</span>
            <span class="color-text-flow">ruh</span>
            <span class="color-text-flow">halinize</span>
            <span class="color-text-flow">göre</span>
            <span class="color-text-flow">(happy, sad ,neutral)</span>
            <span class="color-text-flow">web</span>
            <span class="color-text-flow">sitesini</span>
            <span class="color-text-flow">yeniden</span>
            <span class="color-text-flow">tasarlar</span>
            <span class="color-text-flow">ve</span>
        <br> <span class="color-text-flow">çalma</span>
            <span class="color-text-flow">listesi</span>
            <span class="color-text-flow">önerir!</span>
            <span class="color-text-flow">Lütfen</span>
            <span class="color-text-flow">anlatım</span>
            <span class="color-text-flow">diliniz</span>
            <span class="color-text-flow">ingilizce</span>
            <span class="color-text-flow">olsun.</span>
        </div>
    </div>
<div class="chat-container">
    <div id="messages" class="messages"></div>
    <textarea id="user-input" placeholder="Type your message here..."></textarea>
    <div id="playlist-container" class="playlist-container"></div>
</div>

<div class="img-cntrl">
    <div class="image-controls" id="prev-image">Önceki Fotoğraf</div>
    <div class="image-controls2" id="next-image">Sonraki Fotoğraf</div>
</div>

<script>
    // 5 farklı arka plan resmini bir array 
    const backgrounds = [
        "url('images/background1.gif')",
        "url('images/background2.gif')",
        "url('images/background3.gif')",
        "url('images/background4.gif')",
        "url('images/background5.jpg')",
    ];

    // Sayfa yüklendiğinde rastgele bir arka plan seçmek için
    function setRandomBackground() {
        const randomIndex = Math.floor(Math.random() * backgrounds.length);
        document.body.style.backgroundImage = backgrounds[randomIndex];
    }

    // Arka planları sırayla değiştirmek için
    let currentIndex = 0;
    function rotateBackground() {
        if (!currentEmotion) { // Eğer kullanıcı bir duygu girmediyse, rastgele arka plan değişsin
            document.body.style.backgroundImage = backgrounds[currentIndex];
            currentIndex = (currentIndex + 1) % backgrounds.length; // Sırayı döndür
        }
    }

    // Sayfa yüklendiğinde rastgele bir arka plan ayarla
    setRandomBackground();

    // Arka planın her 3.5 saniyede bir değişmesini sağla
    let backgroundInterval = setInterval(rotateBackground, 3500);

    // Duygulara ait görseller
    const images = {
        Happy: [
            'images/happy1.jpg',
            'images/happy2.jpg',
            'images/happy3.gif',
            'images/happy4.gif',
            'images/happy5.gif'
        ],
        Sad: [
            'images/sad1.jpg',
            'images/sad2.jpg',
            'images/sad3.jpg',
            'images/sad4.gif',
            'images/sad5.jpg'
        ],
        Neutral: [
            'images/neutral1.gif',
            'images/neutral2.jpg',
            'images/neutral3.jpg',
            'images/neutral4.gif',
            'images/neutral5.gif'
        ]
    };

    let currentEmotion = ''; // Başlangıçta duygu yok
    let currentImageIndex = 0;

    // "Önceki Fotoğraf" butonuna tıklandığında görseli değiştir
    document.getElementById('prev-image').addEventListener('click', () => {
        if (currentEmotion) {
            currentImageIndex = (currentImageIndex - 1 + images[currentEmotion].length) % images[currentEmotion].length;
            updateBackgroundImage();
        }
    });

    // "Sonraki Fotoğraf" butonuna tıklandığında görseli değiştir
    document.getElementById('next-image').addEventListener('click', () => {
        if (currentEmotion) {
            currentImageIndex = (currentImageIndex + 1) % images[currentEmotion].length;
            updateBackgroundImage();
        }
    });

    // Duyguya ait görseli güncelle
    function updateBackgroundImage() {
        if (currentEmotion) {
            document.body.style.backgroundImage = `url(${images[currentEmotion][currentImageIndex]})`;
        }
    }

    // Kullanıcı mesajını girdikten sonra, duyguya göre görsel seçimi ve güncelleme
    document.getElementById('user-input').addEventListener('keypress', function (e) {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            let userInput = e.target.value.trim();
            if (userInput) {
                displayMessage(userInput, 'user');
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ message: userInput })
                }).then(response => response.json()).then(data => {
                    displayMessage(data.reply, 'bot');
                    document.body.style.backgroundColor = data.color;
                    currentEmotion = data.reply.split(' ')[0]; // Duyguyu belirlemek için basit bir yöntem
                    currentImageIndex = 0; // Görselin ilkine başla
                    updateBackgroundImage();
                    displayPlaylist(data.playlist_url);

                    // Duygu girildikten sonra rastgele arka plan değişiminin durması
                    clearInterval(backgroundInterval);
                }).catch(error => {
                    console.error('Error:', error);
                });
                e.target.value = '';
            }
        }
    });

    // Mesajları ekrana yazdır
    function displayMessage(message, sender) {
        let messageElement = document.createElement('div');
        messageElement.classList.add('message', sender);
        messageElement.textContent = message;
        document.getElementById('messages').appendChild(messageElement);
    }

    // Playlist URL'si ile iframe gösterme
    function displayPlaylist(url) {
        let playlistContainer = document.getElementById('playlist-container');
        playlistContainer.innerHTML = `<iframe style="border-radius:12px" src="${url}" 
        width="100%" height="352" frameborder="0" allow="autoplay; clipboard-write; 
        encrypted-media; fullscreen; picture-in-picture" loading="lazy"></iframe>`;
    }

</script>


</body>

</html>

